<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>„Åô„Åî„Çç„Åè„Ç≤„Éº„É†</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f8ff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(10, 50px);
      grid-auto-rows: 50px;
      gap: 4px;
      justify-content: center;
      margin: 20px auto;
    }
    .cell {
      border: 3px solid #555;
      border-radius: 8px;
      background: #fff;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .cell.event { background: #fffbdb; }
    .cell.back5 { background: #ffd1d1; }
    .cell.tap { background: #c6f7d0; }
    .cell.type { background: #d0e8ff; }
    .player {
      position: absolute;
      font-size: 24px;
    }
    #dice {
      font-size: 48px;
      margin-top: 10px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #4caf50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    #moveBtn, #restartBtn {
      display: none;
    }
    #eventBox {
      background: rgba(255,255,255,0.95);
      border: 2px solid #666;
      border-radius: 8px;
      padding: 20px;
      margin: 10px auto;
      max-width: 320px;
      display: none;
    }
    #typingModal {
      display: none;
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -30%);
      background: white;
      padding: 20px;
      border: 2px solid black;
      z-index: 1000;
      border-radius: 8px;
    }
    #typingModal p {
      margin: 10px 0;
    }
    input {
      padding: 6px;
      font-size: 14px;
      width: 80%;
    }
    #resultBox {
      font-size: 1.2em;
      font-weight: bold;
      margin-top: 20px;
      background: #fff8dc;
      border: 2px solid #aaa;
      border-radius: 8px;
      padding: 12px;
      display: none;
    }
  </style>
</head>
<body>

<h1>üé≤ „Åô„Åî„Çç„Åè„Ç≤„Éº„É† üé≤</h1>

<div id="startMenu">
  <p>„Éó„É¨„Ç§„É§„Éº‰∫∫Êï∞„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑÔºö</p>
  <button onclick="startGame(1)">1‰∫∫„Åß„ÅÇ„Åù„Å∂</button>
  <button onclick="startGame(2)">2‰∫∫„Åß„ÅÇ„Åù„Å∂</button>
</div>

<div id="gameUI" style="display:none;">
  <div id="dice">üé≤</div>
  <button id="rollBtn">„Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„Çã</button>
  <button id="moveBtn">ÈÄ≤„ÇÄ</button>
  <div id="board"></div>
  <div id="eventBox"></div>
  <button id="restartBtn">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂</button>
  <div id="resultBox"></div>
</div>

<script>
  const boardSize = 50;
  const icons = ['üê±','üê∂'];
  const typingWords = ["„Å≠„Åì","„Åï„Åè„Çâ","„Åü„Åì„ÇÑ„Åç","„Åæ„Å§„Çä","„Åô„Åó","„Åß„Çì„Åó„ÇÉ","„Åô„Åî„Çç„Åè","„Åà„Çì„Å¥„Å§","„ÅØ„Å™„Å≥","„Åä„Å´„Åé„Çä"];

  let players, positions, currentPlayer, playerCount, cellTypes, turnCount, currentRoll;

  const resultBox = document.getElementById('resultBox');

  function getRandomEventCells() {
    const types = ['back5','tap','type'];
    const arr = Array(boardSize).fill('normal');
    const used = new Set();

    types.forEach(t => {
      let p;
      do { p = Math.floor(Math.random()*(boardSize-10)) + 1; } while(used.has(p));
      used.add(p); arr[p] = t;
    });

    const total = Math.floor(Math.random()*4) + 7;
    while(used.size < total) {
      let p;
      do { p = Math.floor(Math.random()*(boardSize-10)) + 1; } while(used.has(p));
      used.add(p);
      arr[p] = types[Math.floor(Math.random()*3)];
    }
    return arr;
  }

  function startGame(num) {
    playerCount = num;
    players = Array.from({length:num},(_,i)=>icons[i]);
    positions = Array(num).fill(0);
    currentPlayer = 0;
    turnCount = 0;
    cellTypes = getRandomEventCells();
    resultBox.innerHTML = "";
    resultBox.style.display = "none";

    document.getElementById('startMenu').style.display='none';
    document.getElementById('gameUI').style.display='block';
    document.getElementById('moveBtn').style.display='none';
    document.getElementById('restartBtn').style.display='none';
    document.getElementById('rollBtn').style.display='inline-block';
    document.getElementById('dice').textContent='üé≤';
    document.getElementById('board').innerHTML='';
    document.getElementById('eventBox').style.display='none';
    initBoard(); updateBoard();
  }

  function initBoard(){
    const b = document.getElementById('board');
    for(let i=0;i<boardSize;i++){
      const c = document.createElement('div');
      c.className = 'cell';
      c.id = 'cell'+i;
      if(cellTypes[i]!=='normal') c.classList.add('event', cellTypes[i]);
      c.textContent = i;
      b.appendChild(c);
    }
  }

  function updateBoard(){
    document.querySelectorAll('.cell').forEach(c=>c.innerHTML=c.id.replace('cell',''));
    players.forEach((icon,i)=>{
      const p = document.createElement('div');
      p.className = 'player'; p.textContent = icon;
      document.getElementById('cell'+positions[i]).appendChild(p);
    });
  }

  document.getElementById('rollBtn').addEventListener('click',()=>{
    currentRoll = Math.floor(Math.random()*6)+1;
    document.getElementById('dice').textContent = `üé≤ ${currentRoll}`;
    document.getElementById('rollBtn').style.display='none';
    document.getElementById('moveBtn').style.display='inline-block';
  });

  document.getElementById('moveBtn').addEventListener('click',()=>{
    positions[currentPlayer] += currentRoll;
    turnCount++;
    document.getElementById('moveBtn').style.display='none';

    if(positions[currentPlayer]>=boardSize-1){
      positions[currentPlayer]=boardSize-1;
      updateBoard();
      resultBox.innerHTML = playerCount === 1
        ? `üéâ „ÇØ„É™„Ç¢ÔºÅ${turnCount}„Çø„Éº„É≥„Åß„Ç¥„Éº„É´„Åó„Åæ„Åó„ÅüÔºÅ`
        : `üéâ „Éó„É¨„Ç§„É§„Éº ${players[currentPlayer]} „ÅÆÂãù„Å°ÔºÅ`;
        resultBox.style.display = "block";
      document.getElementById('restartBtn').style.display='inline-block';
      return;
    }

    updateBoard();
    handleEvent(positions[currentPlayer]);
  });

  document.getElementById('restartBtn').addEventListener('click',()=>{
    document.getElementById('startMenu').style.display='block';
    document.getElementById('gameUI').style.display='none';
  });

  function nextTurn(){
    currentPlayer = (currentPlayer+1)%playerCount;
    document.getElementById('rollBtn').style.display='inline-block';
  }

  function showEventBox(html){
    const eb = document.getElementById('eventBox');
    eb.innerHTML = html; eb.style.display='block';
  }

  function closeEventBox(){
    const eb = document.getElementById('eventBox');
    eb.style.display='none'; eb.innerHTML='';
  }

  function handleEvent(pos) {
    const t = cellTypes[pos];
    if(t==='normal') { nextTurn(); return; }

    if(t==='back5'){
      showEventBox('‚ö†Ô∏è 5„Éû„ÇπÊàª„ÇãÔºÅ');
      setTimeout(()=>{
        positions[currentPlayer] = Math.max(0, positions[currentPlayer] - 5);
        updateBoard(); closeEventBox(); nextTurn();
      },800);
    }
    else if(t==='tap'){
      let count=0, started=false;
      showEventBox('üî• „Äå„Çπ„Çø„Éº„Éà„ÄçÊäº„Åó„Å¶3ÁßíÈÄ£ÊâìÔºÅ<br><button id="startTap">„Çπ„Çø„Éº„Éà</button>');
      document.getElementById('startTap').addEventListener('click',()=>{
        if(started) return;
        started=true; count=0;
        const btn = document.createElement('button');
        btn.id='tapBtn'; btn.textContent='ÈÄ£ÊâìÔºÅ';
        document.getElementById('eventBox').appendChild(btn);
        btn.addEventListener('click',()=>count++);
        setTimeout(()=>{
          btn.disabled=true;
          document.getElementById('eventBox').innerHTML += `<br>${count}Âõû`;
          setTimeout(()=>{
            if(count < 10){
              positions[currentPlayer] = Math.max(0, positions[currentPlayer] - 3);
              updateBoard();
            }
            closeEventBox(); nextTurn();
          },1000);
        },3000);
      });
    }
    else if(t==='type'){
      const target = typingWords[Math.floor(Math.random()*typingWords.length)];
      let started=false, done=false, startTime=0;
      showEventBox('‚å®Ô∏è „Äå„Çπ„Çø„Éº„Éà„ÄçÊäº„Åó„Å¶„Çø„Ç§„Éî„É≥„Ç∞ÔºÅ<br><button id="startType">„Çπ„Çø„Éº„Éà</button>');
      document.getElementById('startType').addEventListener('click',()=>{
        if(started) return;
        started=true; startTime = Date.now();
        const html = `‚å®Ô∏è ${target} „Çí5Áßí‰ª•ÂÜÖ„Å´ÂÖ•Âäõ:<br>
                      <input id="ti"><button id="tb">ÈÄÅ‰ø°</button>`;
        document.getElementById('eventBox').innerHTML = html;
        document.getElementById('tb').addEventListener('click',()=>{
          if(done) return;
          done=true;
          const elapsed = Date.now() - startTime;
          const val = document.getElementById('ti').value.trim();
          const ok = elapsed <=5000 && val === target;
          document.getElementById('eventBox').innerHTML += ok ? '<br>‚úÖÊàêÂäüÔºÅ' : '<br>‚ùåÂ§±ÊïóÔºÅ2„Éû„ÇπÊàª„ÇãÔºÅ';
          if(!ok){
            positions[currentPlayer] = Math.max(0, positions[currentPlayer] - 2);
            updateBoard();
          }
          setTimeout(()=>{ closeEventBox(); nextTurn(); },1000);
        });
        setTimeout(()=>{
          if(done) return;
          done=true;
          document.getElementById('eventBox').innerHTML += '<br>‚è±ÊôÇÈñìÂàá„ÇåÔºÅ2„Éû„ÇπÊàª„ÇãÔºÅ';
          positions[currentPlayer] = Math.max(0, positions[currentPlayer] - 2);
          updateBoard();
          setTimeout(()=>{ closeEventBox(); nextTurn(); },1000);
        },5000);
      });
    }
  }
</script>
</body>
</html>